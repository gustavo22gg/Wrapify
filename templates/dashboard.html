
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Spotify Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* General Reset */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f6f9; /* Light gray background */
            color: #333;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 90%;
            margin: 30px auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .container:hover {
            transform: scale(1.01);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        h1, h2 {
            color: #004c4c; /* Darker teal for better contrast */
            margin: 10px 0;
            letter-spacing: 1px;
        }
        /* Vertical content for Top Tracks */
.content-vertical {
    display: flex;
    flex-direction: column; /* Arrange items vertically */
    align-items: flex-start; /* Align to the start */
    margin: 20px auto;
    gap: 10px; /* Add spacing between track items */
}

.content-vertical .box {
    display: flex;
    flex-direction: column; /* Center-align items */
    justify-content: center;
    align-items: center;
    width: 100%;
    max-width: 400px;
    padding: 15px;
    border: 1px solid #ddd; /* Optional border */
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease-in-out;
    cursor: pointer;
    background-color: #ffffff;
}

.content-vertical .box:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
}


        .greeting {
            background-color: #008080; /* Teal */
            color: #ffffff; /* White text */
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            animation: fadeIn 1.5s ease-in-out;
        }

        .greeting h1 {
            font-size: 30px;
            font-weight: 700;
            margin: 0;
        }

        .greeting h1 .wave {
            display: inline-block;
            animation: wave-animation 2s infinite;
        }

        .greeting p {
            font-size: 16px;
            margin-top: 10px;
            color: #d0f5f5;
        }
        .logout-container {
    position: absolute;
    top: 20px; /* Adjusts vertical positioning */
    left: 20px; /* Adjusts horizontal positioning */
    z-index: 100; /* Ensures it stays above other elements */
}

.logout-button {
    background-color: #008080; /* Match the teal color */
    color: #ffffff; /* White text */
    border: none;
    padding: 10px 20px;
    font-size: 14px;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.logout-button:hover {
    background-color: #005b5b; /* Slightly darker teal on hover */
    transform: translateY(-2px); /* Hover effect */
}

.logout-button:active {
    transform: translateY(0); /* Reset transform on click */
}


        /* Content Container Styling */
        .content-container {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .content-container h2 {
            font-size: 24px;
            font-weight: 700;
            color: #008080;
            border-bottom: 3px solid #008080;
            display: inline-block;
            margin-bottom: 20px;
        }

        /* Box Content Styling */
        .content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .box {
            padding: 20px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: all 0.3s ease-in-out;
        }

        .box:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        /* Chart Styling */
        .chart-container {
            margin: 20px auto;
            width: 100%;
            max-width: 350px;
        }

        /* Button Styling */
        .button-container {
            margin: 20px 0;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .button-container button {
            background-color: #008080;
            color: #ffffff;
            border: none;
            padding: 14px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            text-transform: uppercase;
        }

        .button-container button:hover {
            background-color: #005b5b;
            transform: translateY(-3px);
        }
        /* Account Container */
.account-container {
    position: absolute;
    top: 20px; /* Position from the top */
    right: 20px; /* Position from the right */
    z-index: 100; /* Ensure it stays above other elements */
}

/* Account Button */
.account-button {
    background-color: #008080; /* Teal button */
    color: #ffffff; /* White text */
    border: none;
    padding: 10px 20px;
    font-size: 14px;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.account-button:hover {
    background-color: #005b5b; /* Slightly darker teal on hover */
}

.account-button:active {
    transform: translateY(1px); /* Slight press effect */
}

/* Dropdown Menu */
.dropdown-menu {
    display: none; /* Hidden by default */
    position: absolute;
    top: 100%; /* Position directly below the button */
    right: 0;
    background-color: #ffffff; /* White dropdown background */
    border: 1px solid #ddd; /* Light gray border */
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    padding: 10px;
    text-align: right;
    min-width: 120px;
}

.dropdown-menu .dropdown-item {
    background-color: transparent;
    color: #333; /* Dark text */
    border: none;
    padding: 8px 10px;
    text-align: left;
    font-size: 14px;
    cursor: pointer;
    width: 100%;
    transition: background-color 0.2s ease;
}

.dropdown-menu .dropdown-item:hover {
    background-color: #f4f6f9; /* Light gray on hover */
}

.dropdown-menu .dropdown-item:active {
    background-color: #ddd; /* Darker gray when clicked */
}


        /* Keyframe Animations */
        @keyframes wave-animation {
            0%, 100% { transform: rotate(0deg); }
            10%, 30% { transform: rotate(14deg); }
            20%, 40% { transform: rotate(-8deg); }
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(-20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }

            .button-container button {
                width: 100%;
            }

            .chart-container {
                max-width: 300px;
            }
        }

        @media (max-width: 480px) {
            .greeting h1 {
                font-size: 24px;
            }

            .greeting p {
                font-size: 14px;
            }

            .button-container button {
                font-size: 14px;
                padding: 10px 20px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <body>
        <div class="account-container">
            <button class="account-button">Account</button>
            <div class="dropdown-menu" id="dropdownMenu">
                <button class="dropdown-item" onclick="logout()">Logout</button>
            </div>
        </div>
        <div class="greeting">
            <h1><span class="wave">ðŸ‘‹</span> Hello, {{ username }}!</h1>
            <p>Welcome back to your Spotify Dashboard. Explore your favorite tracks, artists, and playlistsâ€”or take it to the next level by discovering <strong>what your music says about YOU with our AI personality analyzer!</strong></p>
        </div>
    
    

    <div class="container">
        <h1>Your Spotify Dashboard</h1>
        <div class="chart-container">
            <h2>Top Genres (Pie Chart)</h2>
            <canvas id="genrePieChart"></canvas>
        </div>

        <div class="button-container">
            <button onclick="showSection('topTracksContent', renderTopTracks)">Top Tracks</button>
            <button onclick="showSection('topArtistsContent', renderTopArtists)">Top Artists</button>
            <button onclick="showSection('playlistsContent', renderPlaylists)">Playlists</button>
            <button onclick="showSection('listeningHistoryContent', renderListeningHistory)">Listening History</button>
            <button onclick="showSection('personalityContent', getPersonalityAnalysis)">Personality Analysis</button>
        </div>

        <div class="content-container" id="listeningHistoryContent">
            <h2>Listening History</h2>
            <div class="content" id="listeningHistory"></div>
        </div>

        
        
        
        <div class="content-container" id="topTracksContent">
            <h2>Top Tracks</h2>
            <div class="content" id="topTracks"></div>
        </div>

        <div class="content-container" id="topArtistsContent">
            <h2>Top Artists</h2>
            <div class="content" id="topArtists"></div>
        </div>

        <div class="content-container" id="playlistsContent">
            <h2>Your Playlists</h2>
            <div class="content" id="playlists"></div>
        </div>

        <div class="content-container" id="personalityContent">
            <h2>Personality Analysis</h2>
            <div id="personalityResult" class="box"></div>
        </div>
    </div>

    <script>
        const cacheData = JSON.parse('{{ cache_data | tojson | safe }}'); // Data from cache.json

        // Render Pie Chart
        const genres = JSON.parse('{{ genres | tojson | safe }}');
        const genreCounts = new Array(genres.length).fill(1); // All slices have equal weight

        const ctx = document.getElementById('genrePieChart').getContext('2d');
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: genres,
                datasets: [{
                    data: genreCounts,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.7)',
                        'rgba(54, 162, 235, 0.7)',
                        'rgba(255, 206, 86, 0.7)',
                        'rgba(75, 192, 192, 0.7)',
                        'rgba(153, 102, 255, 0.7)',
                        'rgba(255, 159, 64, 0.7)',
                        'rgba(255, 99, 255, 0.7)',
                        'rgba(99, 255, 132, 0.7)',
                        'rgba(192, 75, 75, 0.7)',
                        'rgba(102, 153, 255, 0.7)',
                    ],
                }],
            },
            options: {
                plugins: {
                    tooltip: {
                enabled: false // Disable the tooltip
            },
                    legend: { display: false }, // Hide default legend
                },
                responsive: true,
                animation: { animateRotate: true, animateScale: true },
            },
            plugins: [{
                id: 'drawLabels',
                afterDatasetDraw(chart) {
                    const { ctx, chartArea: { width, height } } = chart;
                    const centerX = width / 2;
                    const centerY = height / 2;
                    const radius = Math.min(width, height) / 2;

                    chart.data.labels.forEach((label, index) => {
                        const meta = chart.getDatasetMeta(0).data[index];
                        const angle = (meta.startAngle + meta.endAngle) / 2;

                        // Adjust position to ensure text stays within the pie
                        const textRadius = radius * 0.65; // Closer to the center
                        const x = centerX + Math.cos(angle) * textRadius;
                        const y = centerY + Math.sin(angle) * textRadius;

                        ctx.save();
ctx.fillStyle = '#333'; // Dark color for better visibility
ctx.font = '500 12px "Roboto", sans-serif'; // Font style
ctx.textAlign = 'center';
ctx.textBaseline = 'middle';
ctx.translate(x, y);

// Ensure labels are always upright
if (angle > Math.PI / 2 && angle < (3 * Math.PI) / 2) {
    ctx.rotate(angle + Math.PI); // Rotate for slices on the left
} else {
    ctx.rotate(angle); // Regular rotation for slices on the right
}

ctx.fillText(label, 0, 0);
ctx.restore();

                    });
                },
            }],
        });
        document.querySelector('.account-button').addEventListener('click', () => {
    const dropdownMenu = document.getElementById('dropdownMenu');
    const isVisible = dropdownMenu.style.display === 'block';
    dropdownMenu.style.display = isVisible ? 'none' : 'block';
});

window.addEventListener('click', (e) => {
    const dropdownMenu = document.getElementById('dropdownMenu');
    const accountButton = document.querySelector('.account-button');

    // Close dropdown if clicked outside
    if (!dropdownMenu.contains(e.target) && !accountButton.contains(e.target)) {
        dropdownMenu.style.display = 'none';
    }
});


        // Render Top Tracks
        function renderTopTracks() {
    const container = document.getElementById('topTracks');
    container.innerHTML = ''; // Clear the container
    const topTracksKey = Object.keys(cacheData).find(key => key.includes('_top_tracks'));
    const topTracksData = cacheData[topTracksKey]?.data || [];

    topTracksData.forEach((track, index) => {
        const div = document.createElement('div');
        div.className = 'box';
        div.innerHTML = `
            <strong>${index + 1}. ${track.name}</strong>
            <p>by <em>${track.artist}</em></p>
            <a href="${track.url}" target="_blank" style="color: #008080; text-decoration: none; font-weight: bold;">
                Listen on Spotify
            </a>
        `;
        container.appendChild(div);
    });
}

        // Render Top Artists
        function renderTopArtists() {
    const container = document.getElementById('topArtists');
    container.innerHTML = ''; // Clear the container
    
    const topArtistsKey = Object.keys(cacheData).find(key => key.includes('_top_artists'));
    const topArtistsData = cacheData[topArtistsKey]?.data || [];

    topArtistsData.forEach(artist => {
        const div = document.createElement('div');
        div.className = 'box';
        div.innerHTML = `
            <a href="${artist.url}" target="_blank" style="color: #008080; text-decoration: none; font-weight: bold;">
                ${artist.name}
            </a>
        `;
        container.appendChild(div);
    });
}



        // Render Playlists
        function renderPlaylists() {
    const container = document.getElementById('playlists');
    container.innerHTML = ''; // Clear the container
    
    const playlistsKey = Object.keys(cacheData).find(key => key.includes('_playlists'));
    const playlistsData = cacheData[playlistsKey]?.data || [];

    playlistsData.forEach(playlist => {
        const div = document.createElement('div');
        div.className = 'box';
        div.innerHTML = `
            <strong>${playlist.name}</strong>
            <p>Total Tracks: ${playlist.tracks}</p>
            <a href="${playlist.url}" target="_blank" style="color: #008080; text-decoration: none; font-weight: bold;">
                Open Playlist on Spotify
            </a>
        `;
        container.appendChild(div);
    });
}

        function getPersonalityAnalysis() {
        const resultContainer = document.getElementById('personalityResult');
        // resultContainer.style.height = resultContainer.scrollHeight + 'px';
        resultContainer.textContent = 'Analyzing with AI... Please wait.';

        fetch('/analyze_personality')
    .then(response => response.json())
    .then(data => {
        console.log(data.personality_analysis); // Log the full response
        if (data.personality_analysis) {
            displayPersonalityAnalysis(data.personality_analysis);
        } else {
            resultContainer.textContent = 'Failed to retrieve personality analysis. Try again later.';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        resultContainer.textContent = 'An error occurred while analyzing personality.';
    });

    }
    function displayPersonalityAnalysis(text) {
    const resultContainer = document.getElementById('personalityResult');
    resultContainer.innerHTML = ''; // Clear existing content

    const paragraphs = text.split('\n\n'); // Split text by paragraphs
    paragraphs.forEach(paragraph => {
        const p = document.createElement('p');
        p.textContent = paragraph;
        resultContainer.appendChild(p);
    });

    // Automatically adjust height to fit content (optional)
    resultContainer.style.maxHeight = 'none';
    resultContainer.style.overflow = 'visible';
}


function renderListeningHistory() {
    const container = document.getElementById('listeningHistory');
    container.innerHTML = ''; // Clear the container
    
    const listeningHistoryKey = Object.keys(cacheData).find(key => key.includes('_listening_history'));
    const listeningHistoryData = cacheData[listeningHistoryKey]?.data || [];

    listeningHistoryData.forEach(item => {
        const div = document.createElement('div');
        div.className = 'box';
        div.innerHTML = `
            <strong>${item.name}</strong> 
            <p>by <em>${item.artist}</em></p>
            <a href="${item.url}" target="_blank" style="color: #008080; text-decoration: none; font-weight: bold;">
                Listen on Spotify
            </a>
            <p><em>Album: ${item.album}</em></p>
            <span>Played at: ${new Date(item.played_at).toLocaleString()}</span>
        `;
        container.appendChild(div);
    });
}

        // Show Sections Dynamically
        function showSection(sectionId, renderFunction) {
            document.querySelectorAll('.content-container').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';
            renderFunction();
        }
        function logout() {
    fetch('/logout', { 
        method: 'POST', 
        headers: { 
            'Content-Type': 'application/json' 
        }
    })
    .then(response => {
        if (response.ok) {
            // Redirect to the home or login page after logging out
            window.location.href = '/';
        } else {
            alert('Logout failed. Please try again.');
        }
    })
    .catch(error => {
        console.error('Error during logout:', error);
        alert('An error occurred. Please try again.');
    });
}
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2488287544380260"
     crossorigin="anonymous"></script>
<!-- Horizontal -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2488287544380260"
     data-ad-slot="3564165514"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </script>
</body>
</html>
